# 异常检测 Anomaly Detection

## 高斯分布 Gaussion Distribution (正态分布)

如果变量$x$符合高斯分布$x \sim N(\mu, \sigma^{2})$, 则其概率密度函数为:

$$
p(x, \mu,\sigma^{2}) = \frac{1}{\sqrt{2\pi\sigma}}exp(-\frac{(x-\mu^{2})}{2\sigma^{2}})
$$

$$
\mu = \frac{1}{m}\sum_{i=1}^{m}x^{(i)}
$$

$$
\sigma^{2} = \frac{1}{m}\sum_{i=1}^{m}(x^{(i)}-\mu)^{2}
$$

![pic1](pic/gaussion1.png)

## 异常检测算法

对于给定的数据集 $x^{(1)},x^{(2)},..,x^{(m)}$，我们要针对每一个特征计算$\mu$和 $\sigma^{2}$的估计值:

$$
\mu_{j} = \frac{1}{m}\sum_{i=1}^{m}x_{j}^{(i)}
$$

$$
\sigma^{2}_{j} = \frac{1}{m}\sum_{i=1}^{m}(x_{j}^{(i)}-\mu_{j})^{2}
$$

然后可以求得:

$$
p(x) = \prod_{j=1}^{n}p(x_j;\mu_j,\sigma_{j}^{2}) = \prod_{j=1}^{n}\frac{1}{\sqrt{2\pi\sigma_{j}}}exp(-\frac{(x_{j}-\mu_{j}^{2})}{2\sigma_{j}^{2}})
$$

定义:

$$
p(x) 
\begin{cases}
    < \varepsilon  & anomaly \\
    >= \varepsilon & normaly
\end{cases}
$$

>$\prod$ 代表元素所有元素的乘积

下面的三维图表表示的是密度估计函数，$z$轴为根据两个特征的值所估计$p(x)$值:

![pic1](pic/gaussion2.png)

我们选择一个$\varepsilon$，将$p(x)=\varepsilon$作为我们的判定边界，当$p(x)>\varepsilon$时预测数据为正常数据，否则为异常

## 开发一个异常检测系统

异常检测算法是一个非监督学习算法，意味着我们无法根据结果变量$y$的值来告诉我们数据是否真的是异常的。我们需要另一种方法来帮助检验算法是否有效。当我们开发一个异常检测系统时，我们从带标记（异常或正常）的数据着手，我们从其中选择一部分正常数据用于构建训练集，然后用剩下的正常数据和异常数据混合的数据构成交叉检验集和测试集。

例如：我们有10000台正常引擎的数据，有20台异常引擎的数据。 我们这样分配数据：

6000台正常引擎的数据作为训练集

2000台正常引擎和10台异常引擎的数据作为交叉检验集

2000台正常引擎和10台异常引擎的数据作为测试集

具体的评价方法如下：

1. 根据测试集数据，我们估计特征的平均值和方差并构建$p(x)$函数
2. 对交叉检验集，我们尝试使用不同的$\varepsilon$值作为阀值，并预测数据是否异常，根据F1值或者查准率与查全率的比例来选择$\varepsilon$
3. 选出$\varepsilon$ 后，针对测试集进行预测，计算异常检验系统的$F1$值，或者查准率与查全率之比

## 选择特征

异常检测假设特征符合高斯分布，如果数据的分布不是高斯分布，异常检测算法也能够工作，但是最好还是将数据转换成高斯分布。